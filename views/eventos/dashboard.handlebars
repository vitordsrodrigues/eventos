<div class="container my-5">

   
    <div class="card text-center shadow-lg mb-5 border-0">
        <div class="card-body p-5">
            <h2 class="card-title mb-3">Bem-vindo, Administrador!</h2>
            <h5 class="card-subtitle text-muted mb-4">Gerencie e crie eventos do CIMOL aqui.</h5>
            <button type="button" class="btn btn-primary btn-lg" data-bs-toggle="modal" data-bs-target="#eventoModal">
                <i class="bi bi-plus-circle"></i> Criar Evento
            </button>
        </div>
    </div>

    
    <div class="card mb-5 shadow-sm border-0">
        <div class="card-header text-center bg-primary text-white">
            <h3 class="m-0">Eventos no Ar</h3>
        </div>
        <div class="card-body">
            <p class="card-text text-center text-muted">Confira a lista de eventos ativos atualmente.</p>

            
            {{#if message}}
                <div class="alert alert-success alert-dismissible fade show" role="alert">
                    <i class="bi bi-check-circle-fill"></i> {{message}}
                    <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
                </div>
            {{/if}}

            
            <div class="list-group">
               
                <div class="container mt-5"></div>
    <div class="row">
        {{#each eventos}}
            <div class="col-12 col-md-6 col-lg-4 mb-4">
                <div class="card h-100 shadow-lg d-flex flex-column">
                    {{#if this.imagem}}
                        <img src="/uploads/{{this.imagem}}" alt="Imagem do evento" class="img-fluid rounded" style="max-height: 200px; width: 100%; object-fit: cover;">
                    {{else}}
                        <img src="" alt="Imagem padrão do evento" class="img-fluid rounded" style="max-height: 200px; width: 100%; object-fit: cover;">
                    {{/if}}

                    <div class="card-body d-flex flex-column flex-grow-1">
                        <h3 class="card-title text-primary">{{this.title}}</h3>
                        <p class="card-text mb-auto">{{this.descricao}}</p>
                    </div>

                    <ul class="list-group list-group-flush">
                        <li class="list-group-item"><strong>Palestrantes:</strong> {{this.palestrantes}}</li>
                        <li class="list-group-item"><strong>Local:</strong> {{this.local}}</li>
                        <li class="list-group-item"><strong>Curso:</strong> {{this.curso}}</li>
                        <li class="list-group-item"><strong>Data Início:</strong> {{this.dataFormatada}}</li>
                        <li class="list-group-item"><strong>Data Final:</strong> {{this.dataLimiteFormatada}}</li>
                        <li class="list-group-item"><strong>Duração:</strong> {{this.duracao}} dias</li>
                        <li class="list-group-item"><strong>Participantes:</strong> <span id="participantesContagem_{{this.id}}">{{this.participantesAtuais}}/{{this.participantes}}</span></li>
                    </ul>

                    <div class="card-body text-start">
                        <form action="/eventos/remove" method="POST" style="display:inline;">
                            <input type="hidden" name="id" value="{{this.id}}">
                            <button type="button" class="btn btn-danger" data-bs-toggle="modal" data-bs-target="#confirmRemoveModal{{this.id}}">
                                <i class="bi bi-trash"></i> Remover
                            </button>
                        </form>

                        <div class="modal fade" id="confirmRemoveModal{{this.id}}" tabindex="-1" aria-labelledby="confirmRemoveModalLabel{{this.id}}" aria-hidden="true">
                            <div class="modal-dialog">
                                <div class="modal-content">
                                    <div class="modal-header">
                                        <h5 class="modal-title" id="confirmRemoveModalLabel{{this.id}}">Confirma Removendo Evento</h5>
                                        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                                    </div>
                                    <div class="modal-body">
                                        <p>Tem certeza que deseja remover o evento "<strong>{{this.title}}</strong>"?</p>
                                    </div>
                                    <div class="modal-footer">
                                        <form action="/eventos/remove" method="POST" style="display:inline;">
                                            <input type="hidden" name="id" value="{{this.id}}">
                                            <button type="submit" class="btn btn-danger">Remover</button>
                                        </form>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <button type="button" class="btn btn-warning" 
                            data-bs-toggle="modal" 
                            data-bs-target="#eventoEditModal" 
                            data-id="{{this.id}}"
                            data-title="{{this.title}}"
                            data-local="{{this.local}}"
                            data-participantes="{{this.participantes}}"
                            data-data="{{this.data}}"
                            data-datalimite="{{this.datalimite}}"
                            data-palestrantes="{{this.palestrantes}}"
                            data-duracao="{{this.duracao}}"
                            data-curso="{{this.curso}}"
                            data-descricao="{{this.descricao}}"
                            onclick="console.log('Data:', this.getAttribute('data-data'))">
                            <i class="bi bi-pencil"></i> Editar
                        </button>
                    </div>
                </div>
            </div>
        {{/each}}
    </div>
</div>
            </div>

        </div>
    </div>

</div>







{{!-- crinado --}}
<div class="modal fade" id="eventoModal" tabindex="-1" aria-labelledby="eventoModalLabel" aria-hidden="true">
  <div class="modal-dialog modal-lg">
    <div class="modal-content">
      <div class="modal-header text-white justify-content-center">
        <h2 class="modal-title" id="eventoModalLabel">Criando Novo Evento</h2>
        <button type="button" class="btn-close btn-close-white position-absolute end-0 me-3" data-bs-dismiss="modal" aria-label="Close"></button>
      </div>
      <div class="modal-body p-4">
        <form action="/eventos/add" method="POST" enctype="multipart/form-data">

          <div class="mb-4">
            <label for="imagem" class="form-label fw-bold">Imagem do Evento:</label>
            <input type="file" id="imagem" name="imagem" class="form-control" accept="image/*">
            <small class="text-muted">Selecione uma imagem para o card do evento (opcional)</small>
          </div>

          <div class="mb-3">
            <label for="title" class="form-label fw-bold">Título:</label>
            <input type="text" id="title" name="title" class="form-control" placeholder="Digite o título do evento" required>
          </div>

          <div class="mb-3">
            <label for="local" class="form-label fw-bold">Local:</label>
            <input type="text" id="local" name="local" class="form-control" placeholder="Digite o local do evento" required>
          </div>

          <div class="row mb-3">
            <div class="col">
              <label for="data" class="form-label fw-bold">Data do Evento:</label>
              <input type="date" id="data" name="data" class="form-control" required>
            </div>
            <div class="col">
              <label for="datalimite" class="form-label fw-bold">Até o Dia:</label>
              <input type="date" id="datalimite" name="datalimite" class="form-control" required>
            </div>
          </div>

          <div class="mb-3">
            <label for="duracao" class="form-label fw-bold">Duração (horas):</label>
            <input type="number" id="duracao" name="duracao" class="form-control" placeholder="Duração do evento em horas" min="1">
          </div>

          <div class="mb-3">
            <label for="curso" class="form-label fw-bold">Curso Relacionado:</label>
            <select id="curso" name="curso" class="form-select">
              <option value="" disabled selected>Selecione o curso associado ao evento</option>
              <option value="nenhum">Nenhum curso relacionado</option>
              <option value="eletronica">Eletrônica</option>
              <option value="eletrotecnica">Eletrotécnica</option>
              <option value="moveis">Móveis</option>
              <option value="mecanica">Mecânica</option>
              <option value="quimica">Química</option>
              <option value="informatica">Informática</option>
              <option value="meio ambiente">Meio Ambiente</option>
            </select>
          </div>

          <div class="mb-3">
            <label for="participantes" class="form-label fw-bold">Número de Participantes:</label>
            <input type="number" id="participantes" name="participantes" class="form-control" placeholder="Quantidade máxima de participantes" min="1" required>
          </div>

          <div class="mb-3">
            <label for="palestrantes" class="form-label fw-bold">Palestrantes:</label>
            <input type="text" id="palestrantes" name="palestrantes" class="form-control" placeholder="Nomes dos palestrantes (separados por vírgula)">
          </div>

          <div class="mb-3">
            <label for="descricao" class="form-label fw-bold">Descrição:</label>
            <textarea id="descricao" name="descricao" class="form-control" placeholder="Descreva o evento" rows="4" required></textarea>
          </div>

          <div class="text-center mt-4">
            <input type="submit" value="Criar Evento" class="btn btn-primary w-100 py-2 fw-bold rounded-pill">
          </div>
          
        </form>
      </div>
    </div>
  </div>
</div>



<div class="modal fade" id="eventoEditModal" tabindex="-1" aria-labelledby="eventoEditModalLabel" aria-hidden="true">
  <div class="modal-dialog modal-lg">
    <div class="modal-content">
      <div class="modal-header bg-primary text-white justify-content-center">
        <h2 class="modal-title" id="eventoEditModalLabel">Editando Evento</h2>
        <button type="button" class="btn-close btn-close-white position-absolute end-0 me-3" data-bs-dismiss="modal" aria-label="Close"></button>
      </div>
      <div class="modal-body p-4">
        <form action="/eventos/edit" method="POST">
          <input type="hidden" name="id" value="{{evento.id}}">

          <div class="mb-3">
            <label for="title" class="form-label fw-bold">Título:</label>
            <input type="text" id="title" name="title" class="form-control" value="{{evento.title}}" required>
          </div>

          <div class="mb-3">
            <label for="local" class="form-label fw-bold">Local:</label>
            <input type="text" id="local" name="local" class="form-control" value="{{evento.local}}" required>
          </div>

          <div class="mb-3">
            <label for="participantes" class="form-label fw-bold">Participantes:</label>
            <input type="number" id="participantes" name="participantes" class="form-control" value="{{evento.participantes}}" required>
          </div>

          <div class="row mb-3">
            <div class="col">
              <label for="data" class="form-label fw-bold">Data de Início:</label>
              <input type="date" id="data" name="data" class="form-control" value="{{evento.data}}" required>
            </div>
            <div class="col">
              <label for="datalimite" class="form-label fw-bold">Data Limite:</label>
              <input type="date" id="datalimite" name="datalimite" class="form-control" value="{{evento.datalimite}}" required>
            </div>
          </div>

          <div class="mb-3">
            <label for="palestrantes" class="form-label fw-bold">Palestrantes:</label>
            <input type="text" id="palestrantes" name="palestrantes" class="form-control" value="{{evento.palestrantes}}">
          </div>

          <div class="mb-3">
            <label for="duracao" class="form-label fw-bold">Duração (dias):</label>
            <input type="number" id="duracao" name="duracao" class="form-control" value="{{evento.duracao}}" required>
          </div>

          <div class="mb-3">
            <label for="curso" class="form-label fw-bold">Curso Relacionado:</label>
            <select id="curso" name="curso" class="form-select" required>
              <option value="" disabled selected>Selecione o curso associado ao evento</option>
              <option value="nenhum">Nenhum curso relacionado</option>
              <option value="eletronica">Eletrônica</option>
              <option value="eletrotecnica">Eletrotécnica</option>
              <option value="moveis">Móveis</option>
              <option value="mecanica">Mecânica</option>
              <option value="quimica">Química</option>
              <option value="informatica">Informática</option>
              <option value="meio_ambiente">Meio Ambiente</option>
            </select>
          </div>

          <div class="mb-3">
            <label for="descricao" class="form-label fw-bold">Descrição:</label>
            <textarea id="descricao" name="descricao" class="form-control" rows="4">{{evento.descricao}}</textarea>
          </div>

          <div class="text-center mt-4">
            <button type="submit" class="btn btn-primary w-100 py-2 fw-bold rounded-pill">Salvar Alterações</button>
          </div>
        </form>
      </div>
    </div>
  </div>
</div>



<style>


</style>


{{!-- nao mexer, modal boostrap, gugu --}}
<script>
    document.addEventListener('DOMContentLoaded', function () {
        var eventoEditModal = document.getElementById('eventoEditModal');
        eventoEditModal.addEventListener('show.bs.modal', function (event) {
            var button = event.relatedTarget;
            
            // Função para formatar a data
            function formatarData(dataString) {
                if (!dataString) return '';
                
                // Log para debug
                console.log('Data original:', dataString);
                
                // Remove qualquer hora/timezone da string
                let data = dataString.split('T')[0];
                if (!data) {
                    data = dataString.split(' ')[0];
                }
                
                // Log para debug
                console.log('Data formatada:', data);
                
                return data;
            }

            // Captura e formata as datas
            var data = formatarData(button.getAttribute('data-data'));
            var datalimite = formatarData(button.getAttribute('data-datalimite'));
            
            // Preenche os campos do modal
            var modal = eventoEditModal;
            modal.querySelector('input[name="id"]').value = button.getAttribute('data-id');
            modal.querySelector('input[name="title"]').value = button.getAttribute('data-title');
            modal.querySelector('input[name="local"]').value = button.getAttribute('data-local');
            modal.querySelector('input[name="participantes"]').value = button.getAttribute('data-participantes');
            modal.querySelector('input[name="data"]').value = data;
            modal.querySelector('input[name="datalimite"]').value = datalimite;
            modal.querySelector('input[name="palestrantes"]').value = button.getAttribute('data-palestrantes');
            modal.querySelector('input[name="duracao"]').value = button.getAttribute('data-duracao');
            modal.querySelector('select[name="curso"]').value = button.getAttribute('data-curso');
            modal.querySelector('textarea[name="descricao"]').value = button.getAttribute('data-descricao');

            // Log para debug
            console.log('Valores preenchidos:', {
                data: modal.querySelector('input[name="data"]').value,
                datalimite: modal.querySelector('input[name="datalimite"]').value
            });
        });
    });

    // Configura data mínima inicial
    document.getElementById('data').min = new Date().toISOString().split('T')[0];
    
    function setMinDateLimite() {
        const dataEvento = new Date(document.getElementById('data').value);
        dataEvento.setDate(dataEvento.getDate());
        document.getElementById('datalimite').min = dataEvento.toISOString().split('T')[0];
    }
</script>
